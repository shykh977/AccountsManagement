<script src="lib/Chart.js/Chart.min.js"></script>

<style>
    .canvas
    {
       
        width: 661px;
        height: 661px;
    }
    .dropdown-backdrop {
        position: absolute;
        
    }
</style>

<section class="content-header breadcrumb-header">
    <h1>
        <ol class="breadcrumb">
            <li><a href="#" class="callback" onclick='PageBackward();'><img src="img/back-arrow.png" /></a></li>
            <li id="" class=""><span class="level" id="Level">Dashboard</span></li>
            <li><span id="MainHeading" class="pagename"></span></li>
        </ol>

    </h1>

    <div href="#" class="calender-link" id="menu1">

        <div class="links-add-date">
            <a href="#" class="calender-linka" id="txtcalender-img" onclick="SubShowPopup('Account Settings','Add')">
                <span class="icon-f"> <img src="img/add-icon.png" /> </span> <b> Add Account</b>
            </a>



            <a href="#" class="calender-linka" id="txtcalender-img" onclick="LedgerFilterShowPopup('Date Filter')">
                <span class="icon-f"><img src="img/calender-icon.png" />	 </span> <b>Select Date</b>
            </a>
        </div>

        <div class="input-group">
            <span class="input-group-addon">
                <img src="img/search_icon.png" />
            </span>
            <input type="search" id="SearchString2" oninput="SearchValue()" class="form-control" placeholder="search">
        </div>




        <!-- <a href="#" class="callback" onclick='PageFarward();' ><img src="img/forword-arrow.png" /></a>-->
    </div>

</section>
    <section class="content-inr expense">



        <div class="row">

            <div id="DivData" class="col-md-12 col-lg-12 col-sm-12 level-3">
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 col-lg-12 main-graph-seation">

                <div class="col-sm-12 col-md-12 col-lg-12">
                    <div class="box dashboard-box">
                        <div class="col-md-12 col-lg-12 graph no-padding">
                            <div class="dashboard-box-g">
                                <div style="width:100%; height:100%;">
                                    <canvas id="CChart1"></canvas>
									<div id="TCChart1" class="table-amount" style="display:none"></div>
                                </div>
                                

                            </div>
                        </div>

                        <div class="col-lg-12 col-md-12 no-padding g-data">
                            <div class="dashboard-box-sl col-lg-6 col-md-6 col-sm-6">
                                <a id="txtincome-title" href="#"> <span class="tittle"></span> </a>
                                <span id="txtincome-value" class="amount"></span>
                            </div>
                            <div class="dashboard-box-sm right">


                                <div class="dashboard-box-sm-d right"><a id="txtline-img" onclick="ChartShape('Chart1','grid')"><img id="grid" src="img/main_cat_Icon/Grid_Deactive.svg"></a></div>
                                <div class="dashboard-box-sm-d right"><a id="txtlineb-img" onclick="ChartShape('Chart1','bar')"><img id="bar" src="img/main_cat_Icon/Bar_Deactive.svg"></a></div>
                                <div class="dashboard-box-sm-d right"><a id="txtincome-sm-img" onclick="ChartShape('Chart1','doughnut')"><img id="doughnut" src="img/main_cat_Icon/Pie_active.svg"></a></div>
                                <div class="dashboard-box-sm-d right"><a id="txtcalender-img" onclick="LedgerFilterShowPopup('Date Filter')"><img src="img/calender-gray.png"></a></div>
                                <div class="selected-filter">

                                    <span class="from-filter"><b>From:</b><span id="SdateDisplay"></span> </span>
                                    <span class="from-filter"><b>To:</b><span id="EdateDisplay"></span> </span>

                                </div>
                            </div>

                        </div>
                        <div class="clear"></div>
                    </div>


                </div>

            </div>
        </div>
    </section>
                <div style="display:none;">
                    <input id="txtDate1" readonly class="form-control date" type="text" placeholder="Select date" required />
                    <input id="txtDate2" readonly class="form-control date" type="text" placeholder="Select date" required />
                </div>


                <div class="row">


                    <script>
                        var level3 = sessionStorage.getItem("ChartLevel");
                        if (level3 == "3")
                            $("#Level").val("Level 3");
                        if (level3 == "2")
                            $("#Level").val("Accounts");


                        function callPage(td) {
                            var val1 = td.id.split(":");
                            sessionStorage.setItem("Accountid", val1[0]);
                            sessionStorage.setItem("AccountTitle", td.name);
                            sessionStorage.setItem("AccountOpening", val1[1]);
                            // sessionStorage.setItem("AccountOpening", val1[1]);
                            var myid = td.offsetParent;
                            sessionStorage.setItem("BackFile", "DashboardLevel3.html");

                            LoadFile("AccountLedger.html");
                        }
                        var myChart = [];
                        var catidarray = [];
                        var catvalues = [];
                        var catname = [];
                        var catnameChart = [];
                        var catcolor = [];
                        var bgcolors = [];
                        var catidchartType = new Array("pie", "bar", "bar", "line");
                        //var icons = ["Bank", "Cash", "Expenses", "Income", "Payments", "Receipts"]
                        var Dashprpority = [];
                        var userid = sessionStorage.getItem("UserID");
                        if (userid == null) {
                            location.href = "login2.html";
                        }
                        var usertitle = sessionStorage.getItem("UserTitle");
                        var Subcatid = sessionStorage.getItem("SubCatID");
                        var type = "I";
                        function displayDashboardDate() {
                            if (window.sessionStorage.getItem("DateParam") == "ALL") {
                                $(".selected-filter").hide();

                            }
                            else {

                                $(".selected-filter").show();
                                document.getElementById("SdateDisplay").innerHTML = returnFormatedDate(window.sessionStorage.getItem("StartDate"), ".");
                                document.getElementById("EdateDisplay").innerHTML = returnFormatedDate(window.sessionStorage.getItem("EndDate"), ".");
                            }
                        }
                        document.getElementById("txtDate1").value = window.sessionStorage.getItem("StartDate");
                        document.getElementById("txtDate2").value = window.sessionStorage.getItem("EndDate");
                        displayDashboardDate()

                        getLedger("ALL");
                        var ledgerobj = [];
                        function SearchValue() {

                            var sv = document.getElementById("SearchString2").value.toUpperCase();
                            //alert(sv);
                            if (sv == "" || sv == 'NaN') {
                                FillTable(ledgerobj);
                                //alert("n");
                            }
                            else {
                                var newArray = [];
                                ledgerobj.forEach(function (k) {
                                    //alert(k.Narration);
                                    var data1 = (" " + k.AccountTitle.toUpperCase() + " ");

                                    if (data1.match(sv) == sv) {
                                        //alert(JSON.stringify(k) + "----" + data1);
                                        newArray.push(k)
                                    };
                                });
                                //alert("F");
                                FillTable(newArray);
                            }
                        }
                        function FillTable(Mdata) {
                            var data = Mdata;
                            var str = "";
                            var dt = "";
                            var TBalance = 0;
                            if (data.length > 0) {
                                // dt = dt + '<div class="gallery js-flickity small">';
                                catidarray = [];
                                catvalues = [];
                                catname = [];
                                poparr = [];
                                bgcolors = [];
                                catcolor = [];
                                catnameChart = [];
                                for (var i = 0; i < data.length; i++) {
                                    catidarray.push(data[i].AccountID);
                                    var bal = 0;
                                    if (data[i].Balance == "" || data[i].Balance == 'NaN') {
                                        bal = "0.00";

                                    }

                                    else if (parseFloat(data[i].Balance) < 0) {
                                        bal = "(" + data[i].Balance.toString() + ")";
                                        bal = bal.replace("-", "");
                                    }
                                    else {
                                        bal = data[i].Balance;
                                    }
                                    TBalance = TBalance + parseInt(data[i].Balance2, 10)

                                    catvalues.push((parseInt(data[i].Balance2, 10)));
                                    catnameChart.push(data[i].AccountTitle.substring(0, 8));
                                    catname.push(data[i].AccountTitle);
                                    bgcolors.push(data[i].Color.replace(")", ",1)").replace("rgb", "rgba"));
                                    catcolor.push(data[i].Color);
                                    var faicon = ""
                                    if (data[i].Icon == "") {
                                        faicon = "fa fa-blank";
                                    }
                                    else {
                                        faicon = data[i].Icon;
                                    }
                                    dt = dt + '<div class="col-sm-6 col-md-3 col-lg-3">';
                                    dt = dt + '    <div class="box">';
                                    dt = dt + '        <div class="expense-box-sl col-lg-12 col-md-12">';
                                    dt = dt + '            <a href="#" class="icon-exp">  <i style="color: transparent; -webkit-text-stroke-width: 1px;  -webkit-text-stroke-color: ' + data[i].Color + ';" class="' + faicon + '"></i></a>';
                                    dt = dt + '                <div class="tittle ">' + data[i].AccountTitle.toUpperCase() + '</div>';
                                    dt = dt + '                    <span class="amount">' + bal + '</span>';
                                    dt = dt + '                    <div class="footer-expense" style="margin-top:4px;">';


                                    //if (parseInt(data[i].BudgetAmount) > 0) {
                                    //    //if (parseInt(data[i].BudgetAmount) > parseInt(data[i].Balance2)) {
                                    //    //    dt = dt + '                            <a id="' + data[i].AccountID + ':' + data[i].AccountTitle + '" href="#" onclick="EntryGraph(this.id)" style="background-color:#f1f2f7;color:white;" data-toggle="tooltip" title="in Budget">  <img src="img/Budgetin.png" alt="TRANSPORTATION"></i></a>';
                                    //    //}
                                    //    //else {
                                    //    //    dt = dt + '                            <a id="' + data[i].AccountID + ':' + data[i].AccountTitle + '" href="#" onclick="EntryGraph(this.id)" style="background-color:#f1f2f7;color:white;" data-toggle="tooltip" title="in Budget">  <img src="img/BudgetOut.png" alt="TRANSPORTATION"></i></a>';
                                    //    //}
                                    //    var percent = Math.abs(parseFloat(data[i].Balance2) / parseFloat(data[i].BudgetAmount) * 100)
                                    //    dt = dt + '<div data-toggle="tooltip" title="Remaining:' + (parseFloat(data[i].BudgetAmount) - parseFloat(data[i].Balance2)) + "/" + parseFloat(data[i].BudgetAmount) + '" id="' + data[i].AccountID + ':' + data[i].AccountTitle + '" style="width:80%;background-color:#e6dfdf;height:15px; margin-left:auto;margin-right:auto;;margin-bottom:10px;cursor:pointer;" onclick="EntryGraph(this.id)" ><div data-toggle="tooltip" title="Spent:' + parseFloat(data[i].Balance2) + "/" + parseFloat(data[i].BudgetAmount) + '" style="width:' + percent + '%;max-width: 100%;height:100%;background-color:red"></div></div>';
                                    //}
                                    //else {
                                        dt = dt + '<div  id="budget' + data[i].AccountID + '" style="width:80%;background-color:#ffffff;height:15px; margin-left:auto;margin-right:auto;;margin-bottom:10px;"  ></div>';
                                    //}




                                    // dt = dt + ' <a id="' + data[i].AccountID + ':' + data[i].AccountTitle + '" name="' + data[i].AccountTitle + '" href="#" onclick="LoadSub(this.id);" class=" flip-card-back-a " style=" margin-right:10px;"><i class="fa fa-search"></i></a>  <a id="' + data[i].AccountID + ":" + data[i].Main + ":" + data[i].SubCatID + ":" + data[i].AccountTitle + ':' + data[i].Icon + ":" + data[i].Color + ":" + data[i].ODR + ":" + data[i].OCR + ":" + data[i].PaySource + '"  name="' + data[i].AccountTitle + '" href="#" onclick="editCatSub(this.id)" class="flip-card-back-a" style=" margin-left:10px;"><i class="fa fa-edit"></i></a>'

                                    dt = dt + '                        <a id="' + data[i].AccountID + ':' + data[i].AccountTitle + '" name="' + data[i].AccountTitle + '" href="#" onclick="callPage(this);"  class="search-expense"> <img src="img/search.png" alt="TRANSPORTATION"></a>';
                                    dt = dt + '                            <a id="' + data[i].AccountID + ":" + data[i].Main + ":" + data[i].SubCatID + ":" + data[i].AccountTitle + ':' + data[i].Icon + ":" + data[i].Color + ":" + data[i].ODR + ":" + data[i].OCR + ":" + data[i].PaySource + ":" + data[i].Nature + '"  name="' + data[i].AccountTitle + '" href="#" onclick="editCatSub(this.id)" class="edit-expense"> <img src="img/edit.png" alt="TRANSPORTATION"></a>';
                                    dt = dt + '                </div>';
                                    dt = dt + '         </div>';
                                    dt = dt + '      </div>';
                                    dt = dt + ' </div>';











                                    str = str + dt;
                                    dt = "";



                                }




                                str = str + dt;

                                //str = str + '</div>';

                                document.getElementById("DivData").innerHTML = str;
                                //getPaymentandReceipt(param);
                                $('#loadI').removeAttr('class');// attr('class', 'fa fa-gear');

                                //document.getElementById("MainHeading").innerHTML = data[0].Main;
                                document.getElementById("txtincome-title").innerHTML = "BALANCE"; //data[0].Main;
                                document.getElementById("txtincome-value").innerHTML = parseFloat(TBalance).toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")
                                CalculateBudget(Mdata);
                                $('#loadI').attr('class', 'fa fa-gear');

                                drawchartsingle("doughnut");

                            }

                        }
                        function CalculateBudget(a) {
                            var Cdate = new Date();
                            var data1 = a;
                            var dd = ""
                            if ((Cdate.getMonth() + 1) < 10) dd = "0" + (Cdate.getMonth() + 1); else dd = (Cdate.getMonth() + 1);
                            var Sdate = Cdate.getFullYear() + "-" + dd + "-" + Cdate.getDate();
                            //alert(JSON.stringify(data1));
                            for (var i = 0; i < data1.length; i++) {
                                var url = 'Accounts.asmx/BudgetAmountTillDate';
                                var data11 = data1[i];
                                var paramdata = "{'AccountID':'" + data11.AccountID + "','StartDate':'" + Sdate + "'}"
                                CallBudgetAJAX(paramdata, url, data11);
                            }
                        }
                        function CallBudgetAJAX(paramdata, url, data11) {
                            $.ajax({
                                type: 'POST',
                                url: url,
                                dataType: 'json',
                                data: paramdata,
                                contentType: 'application/json; charset=utf-8',

                                success: function (response) {
                                    var txt = '{"Row": ' + response.d + '}';
                                    var data = JSON.parse(txt);
                                    var dt = "";
                                   // alert(JSON.stringify(data11));
                                    if (data.Row.length > 0) {
                                        if (parseFloat(data.Row[0].BudgetAmount) > 0) {
                                            //alert(data.Row[0].Balance + "," + data.Row[0].BudgetAmount)
                                            var percent = Math.abs(parseFloat(data.Row[0].Balance) / parseFloat(data.Row[0].BudgetAmount) * 100)
                                            dt = dt + '<div data-toggle="tooltip" title="Remaining:' + (parseFloat(data.Row[0].Balance) - parseFloat(data.Row[0].BudgetAmount)) + "/" + parseFloat(data.Row[0].BudgetAmount) + '" id="' + data11.AccountID + ':' + data11.AccountTitle + '" style="width:100%;background-color:#e6dfdf;height:15px; margin-left:auto;margin-right:auto;;margin-bottom:10px;cursor:pointer;" onclick="EntryGraph(this.id)" ><div data-toggle="tooltip" title="Spent:' + parseFloat(data.Row[0].Balance) + "/" + parseFloat(data.Row[0].BudgetAmount) + '" style="width:' + percent + '%;max-width: 100%;height:100%;background-color:red"></div></div>';
                                            document.getElementById("budget" + data11.AccountID).innerHTML = dt;
                                        }

                                    }
                                },
                                error: function (error) {
                                    console.log(error);
                                }
                            });
                        }
                        function getLedger(param) {

                            //$('#loadI').attr('class', 'fa fa-refresh fa-spin');
                            //loading script
                            var userid = window.sessionStorage.getItem("UserID");
                            param = window.sessionStorage.getItem("DateParam");
                            var Sdate = document.getElementById("txtDate1").value;
                            var Edate = document.getElementById("txtDate2").value;
                            var url = "";
                            var paramdata = "";
                            if (param == "ALL") {
                                url = 'Accounts.asmx/loadAccountsbyUserID'
                                paramdata = "{'UserID':'" + userid + "'}";
                            }
                            else {
                                url = 'Accounts.asmx/loadAccountsbyUserIDFilter';
                                paramdata = "{'UserID':'" + userid + "','StartDate':'" + Sdate + "','EndDate':'" + Edate + "'}"
                            }
                            // alert(param+ "--"+ url + "---" + paramdata)


                         
                                $.ajax({
                                    type: 'POST',
                                    url: url,
                                    dataType: 'json',
                                    data: paramdata,
                                    contentType: 'application/json; charset=utf-8',

                                    success: function (response) {

 

                                        var txt = '{"Row": ' + response.d + '}';
                                        var data = JSON.parse(txt);

                                        if (data.Row.length > 0) {
                                            // dt = dt + '<div class="gallery js-flickity small">';
                                            ledgerobj = [];
                                            for (var i = 0; i < data.Row.length; i++) {
                                                var Dvalue = {
                                                    AccountID: data.Row[i].AccountID
                                                    , AccountTitle: data.Row[i].AccountTitle
                                                    , Color: data.Row[i].Color
                                                    , Icon: data.Row[i].Icon
                                                    , DateofCreation: data.Row[i].DateofCreation
                                                    , ODR: data.Row[i].ODR
                                                    , OCR: data.Row[i].OCR
                                                    , Status: data.Row[i].Status
                                                    , CellNo: data.Row[i].CellNo
                                                    , Email: data.Row[i].Email
                                                    , SubCatID: data.Row[i].SubCatID
                                                    , Balance: data.Row[i].Balance
                                                    , Balance2: data.Row[i].Balance2
                                                    , Main: data.Row[i].Main
                                                    , Exp: data.Row[i].Exp
                                                    , Inc: data.Row[i].Inc
                                                    , PaySource: data.Row[i].PaySource
                                                    , Nature: data.Row[i].Nature
                                                    , BudgetAmount: data.Row[i].BudgetAmount
                                                }
                                                ledgerobj.push(Dvalue);


                                            }




                                            FillTable(ledgerobj);
                                            $('#loadI').attr('class', 'fa fa-gear');

                                            drawchartsingle("doughnut");

                                        }

                                        //drawChart();
                                        // google.charts.load('current', { 'packages': ['corechart'], "callback": drawChart });

                                    },
                                    error: function (error) {
                                        console.log(error);
                                    }
                                });

                             

                        }

                        //function getPaymentandReceipt(param) {

                        //    //$('#loadI').attr('class', 'fa fa-refresh fa-spin');
                        //    //loading script
                        //    var Sdate = document.getElementById("txtDate1").value;
                        //    var Edate = document.getElementById("txtDate2").value;
                        //    var url = "";
                        //    var paramdata = "";
                        //    if (param == "ALL") {
                        //        url = 'Accounts.asmx/loadRP'
                        //        paramdata = paramdata = "{'UserID':'" + userid + "','StartDate':'" + param + "','EndDate':'" + param + "'}";
                        //    }
                        //    else {
                        //        url = 'Accounts.asmx/loadRP';
                        //        paramdata = "{'UserID':'" + userid + "','StartDate':'" + Sdate + "','EndDate':'" + Edate + "'}"
                        //    }
                        //    // alert(param+ "--"+ url + "---" + paramdata)
                        //    $.ajax({
                        //        type: 'POST',
                        //        url: url,
                        //        dataType: 'json',
                        //        data: paramdata,
                        //        contentType: 'application/json; charset=utf-8',

                        //        success: function (response) {

                        //            var txt = '{"Row": ' + response.d + '}';
                        //            var data = JSON.parse(txt);
                        //            var str = "";
                        //            var dt = "";
                        //            var TBalance = 0;
                        //            // dt = dt + '<div class="gallery js-flickity small">';
                        //            //parseInt(data.Row[i].Balance2, 10)
                        //            if (data.Row.length > 0) {

                        //                // ******************* dummy *************
                        //                dt = dt + ' <div class="col-md-2 col-lg-6 col-sm-6 col-xs-6">';
                        //                dt = dt + '     <div class="info-box">';
                        //                dt = dt + '         <a href="#" class="info-box-icon ' + Dashprpority[4].toLowerCase() + '-bg " ><span id="txtcash" class="info-box-text mobile-only">' + Dashprpority[4].toUpperCase() + '</span><img src="img/main_cat_Icon/' + Dashprpority[4] + '.png"></a>';
                        //                dt = dt + '             <div class="info-box-content">';
                        //                dt = dt + '                 <br>';
                        //                dt = dt + '                     <span id="txtcash" class="info-box-text desktop-only">' + Dashprpority[4].toUpperCase() + '</span><br>';
                        //                dt = dt + '                         <span id="txtcash-value" class="info-box-number">' + parseInt(data.Row[0].Payment, 10) + '</span>';
                        //                dt = dt + '             </div>';
                        //                dt = dt + '     </div>';
                        //                dt = dt + ' </div>';
                        //                dt = dt + ' <div class="col-md-2 col-lg-6 col-sm-6 col-xs-6">';
                        //                dt = dt + '     <div class="info-box">';
                        //                dt = dt + '         <a href="#" class="info-box-icon ' + Dashprpority[5].toLowerCase() + '-bg " ><span id="txtcash" class="info-box-text mobile-only">' + Dashprpority[5].toUpperCase() + '</span><img src="img/main_cat_Icon/' + Dashprpority[5] + '.png"></a>';
                        //                dt = dt + '             <div class="info-box-content">';
                        //                dt = dt + '                 <br>';
                        //                dt = dt + '                     <span id="txtcash" class="info-box-text desktop-only">' + Dashprpority[5].toUpperCase() + '</span><br>';
                        //                dt = dt + '                         <span id="txtcash-value" class="info-box-number">' + parseInt(data.Row[0].Receipt, 10) + '</span>';
                        //                dt = dt + '             </div>';
                        //                dt = dt + '     </div>';
                        //                dt = dt + ' </div>';
                        //                // ****************** dummay end **********

                        //            }
                        //            str = str + dt;

                        //            //str = str + '</div>';

                        //            document.getElementById("DivData").innerHTML = document.getElementById("DivData").innerHTML + str;
                        //            $('#loadI').removeAttr('class');// attr('class', 'fa fa-gear');


                        //            $('#loadI').attr('class', 'fa fa-gear');





                        //            //drawChart();
                        //            // google.charts.load('current', { 'packages': ['corechart'], "callback": drawChart });

                        //        },
                        //        error: function (error) {
                        //            console.log(error);
                        //        }
                        //    });
                        //}
                        function LoadSub(a) {
                            sessionStorage.setItem("AccountID", a);
                            sessionStorage.setItem("Accountid", a);
                            sessionStorage.setItem("BackFile", "DashboardLevel3.html");
                            LoadFile("AccountLedger.html");
                        }


                        var element, bgColor, brightness, r, g, b, hsp;
                        var AccountID1, CatID;
                        function editCatSub(a) {
                            sessionStorage.setItem("AccountData", a);
                            //alert(a);
                            //data.Row[i].AccountID + ":" + data.Row[i].Main + ":" + data.Row[i].SubCatID + ":" + data.Row[i].AccountTitle + ':' + data.Row[i].Icon + ":" + data.Row[i].Color + ":" + data.Row[i].ODR + ":" + data.Row[i].OCR + ":" + data.Row[i].Exp + ":" + data.Row[i].Inc + ":" + data.Row[i].PaySource
                            var v = a.split(":");

                            //CatName, divColor, IconS
                            AccountID1 = v[0];
                            //alert(v[2]);
                            CatID = v[2];
                            document.getElementById("CatName").value = v[3];
                            document.getElementById("divColor").style.backgroundColor = v[5];
                            document.getElementById("IconS").className = v[4];
                            document.getElementById("OpenDR").value = v[6];
                            document.getElementById("OpenCR").value = v[7];
                            document.getElementById("AccPayable").checked = (v[8] == "1" ? true : false);
                            $("input[name=optradio][value=" + v[v.length - 1] + "]").prop('checked', true);


                            SubShowPopup("Account Settings", "Edit");
                            //LoadFile("UserSubCatAddEdit.html");

                        }
                    </script>
                    <script>
                        var countlegend = 0;

                        //google.charts.load("visualization", "1", { packages: ["corechart"], "callback": drawChart });


                        function drawChart() {
                            //alert("1");
                            for (var a = 0; a < catidarray.length; a++) {
                                var ch = a + 1;

                                // alert(catidarray[a]);
                                DrawChartbyChart(catidarray[a], "Chart" + ch, catidchartType[a], a);
                            }
                            //DrawChartbyChart('1461F357-3F31-4D8F-869A-FF97E98C4199', "Chart1", "Pie");
                            //DrawChartbyChart('61264BA3-3AB7-4E9D-A3C9-E779BFFD0D6B', "Chart2", "Bar");
                            //DrawChartbyChart('FD8AB8FA-C28B-49C0-8B18-C912F1F5398B', "Chart3", "Grid");
                            //DrawChartbyChart('CD37F50A-D372-4DC1-8A9F-3E84FCFB039E', "Chart4", "Line");




                        }

                        var scalevalue;
                        var chartdata;
                        var chartOption;
                        function returnScalvalue(ChartType) {

                            if (ChartType == "bar")
                                scalevalue = {
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero: true,
                                            fontSize: 8,
                                            display: true
                                        },
                                        gridLines: {
                                            display: true,
                                            drawBorder: true
                                        }

                                    }],

                                    xAxes: [{
                                        barPercentage: 1,
                                        offset: true,
                                        ticks: {
                                            minRotation: 90,
                                            display: true //this will remove only the label
                                        },
                                        gridLines: {
                                            display: false
                                            ,
                                            drawBorder: true
                                        }
                                    }]
                                }
                            else
                                scalevalue = {
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero: true,
                                            fontSize: 8,
                                            display: false
                                        },
                                        gridLines: {
                                            display: false,
                                            drawBorder: false
                                        }

                                    }],

                                    xAxes: [{
                                        barPercentage: 1,
                                        offset: true,
                                        ticks: {
                                            display: false //this will remove only the label
                                        },
                                        gridLines: {
                                            display: false
                                            ,
                                            drawBorder: false
                                        }
                                    }]
                                }
                            chartOption = {


                                maintainAspectRatio: false,
                                cutoutPercentage: 30,
                                scales: scalevalue,
                                legend: {
                                    display: false
                                }
                            }


                        }
                        function drawchartsingle(ChartType) {
                            // alert(catvalues);

                            returnScalvalue(ChartType);
                            chartdata = {
                                labels: catnameChart,
                                mynames: catname,
                                mydata: catvalues,
                                mycolor: catcolor,
                                mykeys: catidarray,
                                myheader: "Main Dashboard",
                                datasets: [{

                                    data: catvalues,
                                    MyKeys: catidarray,
                                    backgroundColor: bgcolors,
                                    borderColor: catcolor,
                                    borderWidth: 1
                                }]
                            };

                            var ctx = document.getElementById("CChart1");
                            if (myChart.length > 0) {
                                var MChart = myChart[1];
                                MChart.destroy();
                            }
                            myChart[1] = new Chart(ctx, {
                                type: ChartType,
                                data: chartdata,
                                options: chartOption
                            });
                            ctx.onclick = function (evt) {
                                var activePoints = myChart[1].getElementsAtEvent(evt);
                                if (activePoints[0]) {
                                    var chartData = activePoints[0]['_chart'].config.data;
                                    var idx = activePoints[0]['_index'];

                                    var label = chartData.labels[idx];
                                    var value = chartData.datasets[0].data[idx];
                                    var Key1 = chartData.datasets[0].MyKeys[idx];

                                    // var url = "http://example.com/?label=" + label + "&value=" + value + "&ID=" + Key1
                                    //sessionStorage.setItem("SubCatID", Key1);
                                    sessionStorage.setItem("Accountid", Key1);
                                    sessionStorage.setItem("AccountTitle", label);
                                    sessionStorage.setItem("AccountOpening", 0);
                                    LoadFile("AccountLedger.html");

                                    //alert(url);
                                }
                            };
                        }


                        function ChartShape(a, b) {
                            var scalevalue = returnScalvalue(b);
                            var bb = parseInt(a.replace("Chart", ""));
                            var MChart = myChart[bb];
                            if (b != 'grid') {
                                //alert(myChart.length);
                                MChart.config.type = b;
                                //MChart.config.scales = scalevalue;
                                MChart.destroy();
                                var ctx = document.getElementById("C" + a).getContext("2d");

                                myChart[bb] = new Chart(ctx, { type: b, data: chartdata, options: chartOption });
                                //drawchartsingle(b);
                                document.getElementById("C" + a).style.display = "block";
                                document.getElementById("TC" + a).style.display = "none";

                            }
                            else {
                                //alert("T");
                                var lbl = MChart.config.data.mynames;
                                var dat = MChart.config.data.mydata;
                                var colr = MChart.config.data.mycolor;
                                var main1 = MChart.config.data.myheader;
                                var Key1 = MChart.config.data.mykeys;

                                var st = "";
                                for (var i = 0; i < lbl.length; i++) {
                                    var bval1 = parseFloat(dat[i]).toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,")
                                    st = st + "<tr style='color:" + colr[i] + ";cursor:pointer;' onclick=LoadSub('" + Key1[i] + "') ><td class='text-cGG'>" + (i + 1) + ".</td><td class='text-l' >" + lbl[i] + "</td><td class='text-r' >" + bval1 + " </td></tr>";
                                }
                                //alert("T1");
                                var dt = "";
                                // dt = dt + '<div id=' + "TC" + a + ' class="row tableFlow" style=" overflow-y:auto;margin-left:15px; margin-right:15px;">';
                                //dt = dt + '<div class="col-12" style="color:#747572;padding-left:15px;padding-top:15px; padding-bottom:0px;    font-weight:bold;">' + main1 + '</div>';
                                //dt = dt + '<div class="col-12">';
                                dt = dt + '    <table class="table table-borderless table-hover " >';
                                dt = dt + '        <thead>';
                                dt = dt + '            <tr >';
                                dt = dt + '                <th class="text-cGG" >S.No.</th>';
                                dt = dt + '                <th class="text-l" >Description</th>';
                                dt = dt + '                <th class="text-r" >Amount</th>';
                                dt = dt + '            </tr>';
                                dt = dt + '        </thead>';
                                dt = dt + '        <tbody>';
                                dt = dt + '        ' + st;
                                dt = dt + '        </tbody>';
                                dt = dt + '    </table>';
                                //dt = dt + '</div>';
                                //dt = dt + '</div>';
                                // dt = dt + '</div>';
                                document.getElementById("TC" + a).innerHTML = dt;
                                document.getElementById("TC" + a).style.display = "block";
                                document.getElementById("C" + a).style.display = "none";

                                //alert(dt);
                            }
                            activeIcon(b);
                        }

                        function activeIcon(a) {

                            document.getElementById("bar").src = 'img/main_cat_Icon/Bar_Deactive.svg';
                            document.getElementById("doughnut").src = 'img/main_cat_Icon/Pie_Deactive.svg';
                            document.getElementById("grid").src = 'img/main_cat_Icon/Grid_Deactive.svg';
                            if (a == "bar") {
                                document.getElementById("bar").src = 'img/main_cat_Icon/Bar_Active.svg';
                            }
                            if (a == "doughnut") {
                                document.getElementById("doughnut").src = 'img/main_cat_Icon/Pie_active.svg';
                            }
                            if (a == "grid") {
                                document.getElementById("grid").src = 'img/main_cat_Icon/Grid_Active.svg';
                            }


                        }
                    </script>
                    <!-- Model for Filter ******************************************-->
                    <div id="LedgerFilter99" class="modal fade">
                        <div class="modal-dialog">

                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h4 id="LedgerFilterTitle" class="modal-title"></h4>
                                    <button type="button" class="close" data-dismiss="modal" onmouseup="LedgerOptFilter = 'Cancel';">&times;</button>
                                </div>

                                <div id="LedgerInvDiv" class="modal-body">
                                    <div class="col-lg-12 col-md-12 col-sm-12 no-padding">

                                        <div class="col-lg-4 col-md-4 col-sm-12">
                                            <div class="title">
                                                <input id="LedgerFilter1" name="LedgerFilterSelect" type="radio" value="1" checked onchange="CallFilterCheck(this)" /><label for="LedgerFilter1">Regular</label>
                                            </div>

                                            <div class="col-12">
                                                <select id="LedgerFilterList" class="w-100 form-control pl-0 ">
                                                    <option value="-1">ALL</option>
                                                    <option value="0">Today</option>
                                                    <option value="30" selected>Last 30 Days</option>
                                                    <option value="90">Last Quarter</option>
                                                    <option value="180">Last Six Months</option>
                                                    <option value="365">Full Year</option>

                                                </select>
                                            </div>


                                        </div>


                                        <div class="col-lg-8 col-md-8 col-sm-12">

                                            <div class="col-12">
                                                <div class="title">
                                                    <input id="LedgerFilter2" name="LedgerFilterSelect" type="radio" value="2" onchange="CallFilterCheck(this)" /><label for="Filter2">Custom</label>
                                                </div>
                                                <div class="col-lg-6 col-md-6  col-sm-12 no-padding">
                                                    <div class="col-12">
                                                        <input placeholder="From" type="date" class="form-control" id="LedgerFromDate" />
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 col-md-6 col-sm-12 m-no-padding">

                                                    <div class="col-12 ">
                                                        <input placeholder="To" type="date" class="form-control" id="LedgerToDate" />
                                                    </div>
                                                </div>
                                            </div>



                                        </div>



                                    </div>







                                    <style>
                                        .MyCancel
                                        {
                                            background-image: url('MunshiImagesMain/Cancel_Normal.svg');
                                            background-repeat: no-repeat;
                                            color: #EB2227;
                                            padding: 4px;
                                            font-weight: bold;
                                        }

                                        .Itext
                                        {
                                            border-radius: 0px !important;
                                            background-color: #747572 !important;
                                            color: whitesmoke;
                                            border: solid 1px #747572;
                                        }

                                        #Filter *
                                        {
                                            border-radius: 0px !important;
                                        }

                                        .MyCancel:hover
                                        {
                                            background-image: url('MunshiImagesMain/Cancel_Hover.svg');
                                            background-repeat: no-repeat;
                                            color: gray;
                                            padding: 4px;
                                            text-decoration: unset;
                                            font-weight: bold;
                                        }

                                        .MySubmit
                                        {
                                            background-image: url('MunshiImagesMain/Submit_Normal.svg');
                                            background-repeat: no-repeat;
                                            color: #0C72BA;
                                            padding: 4px;
                                            font-weight: bold;
                                        }

                                            .MySubmit:hover
                                            {
                                                background-image: url('MunshiImagesMain/Submit_Hover.svg');
                                                background-repeat: no-repeat;
                                                color: gray;
                                                padding: 4px;
                                                text-decoration: unset;
                                                font-weight: bold;
                                            }
                                    </style>
                                    <div class="modal-footer">
                                        <div class="col-12 text-right">
                                            <a id="LedgerbtnReset" href="#" data-dismiss="modal" onmouseup="LedgerOptFilter = 'Cancel';" class="MyCancel">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     Cancel</a>
                                            &nbsp;&nbsp;&nbsp;&nbsp;
                                            <a id="Ledgerbtnsave" href="#" class="MySubmit" data-dismiss="modal" onmouseup="LedgerOptFilter = 'Apply';">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;    Apply</a>
                                        </div>


                                    </div>




                                </div>

                            </div>
                            <script>
                                $('#LedgerFromDate').prop("disabled", true);
                                $('#LedgerToDate').prop("disabled", true);
                                function CallFilterCheck(a) {
                                    if (a.id == "LedgerFilter1" && a.checked) {
                                        $('#LedgerFilterList').prop("disabled", false);
                                        $('#LedgerFromDate').prop("disabled", true);
                                        $('#LedgerToDate').prop("disabled", true);

                                    } else
                                        if (a.id == "LedgerFilter2" && a.checked) {
                                            $('#LedgerFilterList').prop("disabled", true);
                                            $('#LedgerFromDate').prop("disabled", false);
                                            $('#LedgerToDate').prop("disabled", false);

                                        }
                                }

                                var LedgerOptFilter = "";
                                var LedgerFormOptionOptFilter = "";
                                function LedgerFilterShowPopup(a) {
                                    //alert(LedgerOptFilter);
                                    $("#LedgerFilterTitle").html('<span style="color:oranged;">' + a + '</span>');
                                    $("#LedgerFilter99").modal();
                                    FormOptionOptFilter = a;

                                }

                                $('#LedgerFilter99').on('hidden.bs.modal', function (e) {
                                    // alert(LedgerOptFilter);
                                    if (LedgerOptFilter == "Cancel") {
                                        //alert("Reminder");
                                        //SendInvite("Reminder");
                                        //alert(LedgerFormOptionOptFilter + " Cancel");
                                    }
                                    else if (LedgerOptFilter == "Apply") {

                                        if ($('#LedgerFilterList').prop("disabled") == false) {

                                            var val1 = parseInt(document.getElementById("LedgerFilterList").value);
                                            //alert(val1);
                                            var param = "none";
                                            if (val1 == "-1") {
                                                param = "ALL";
                                                window.sessionStorage.removeItem("StartDate");
                                                window.sessionStorage.removeItem("EndDate");
                                            }
                                            else {
                                                var dateto = new Date();
                                                var datefrom = new Date();
                                                datefrom.setDate(dateto.getDate() - val1);

                                                var Sdate = (dateto.getDate() < 10 ? "0" + dateto.getDate() : dateto.getDate()) + "." + (dateto.getMonth() < 10 ? "0" + (dateto.getMonth() + 1) : (dateto.getMonth() + 1)) + "." + dateto.getFullYear(); //document.getElementById("txtDate1").value;
                                                var sd = Sdate.split(".");

                                                document.getElementById("txtDate2").value = sd[2] + "." + sd[1] + "." + sd[0];
                                                var Edate = (datefrom.getDate() < 10 ? "0" + datefrom.getDate() : datefrom.getDate()) + "." + (datefrom.getMonth() < 10 ? "0" + (datefrom.getMonth() + 1) : (datefrom.getMonth() + 1)) + "." + datefrom.getFullYear(); //document.getElementById("txtDate1").value;
                                                sd = Edate.split(".");
                                                document.getElementById("txtDate1").value = sd[2] + "." + sd[1] + "." + sd[0];
                                                window.sessionStorage.setItem("StartDate", document.getElementById("txtDate1").value);
                                                window.sessionStorage.setItem("EndDate", document.getElementById("txtDate2").value);
                                                //alert(param + "pppp");
                                            }
                                            window.sessionStorage.setItem("DateParam", param);
                                            //alert(param + "pppp");
                                            getLedger(param);


                                        } else {
                                            var param = "none";
                                            var Sd1 = document.getElementById("LedgerFromDate").value;
                                            var Ed1 = document.getElementById("LedgerToDate").value;
                                            var SD2 = Sd1.split("-");
                                            document.getElementById("txtDate1").value = SD2[0] + "." + SD2[1] + "." + SD2[2];

                                            var ED2 = Ed1.split("-");
                                            document.getElementById("txtDate2").value = ED2[0] + "." + ED2[1] + "." + ED2[2];
                                            window.sessionStorage.setItem("StartDate", document.getElementById("txtDate1").value);
                                            window.sessionStorage.setItem("EndDate", document.getElementById("txtDate2").value);
                                            //alert(param + "pppp");
                                            window.sessionStorage.setItem("DateParam", param);

                                            getLedger(param);
                                        }
                                        displayDashboardDate();
                                        //alert("newInvitation");
                                        //SendInvite("newInvitation");

                                        var tt;
                                        if (LedgerFormOptionOptFilter == "To") {
                                            //tt = $("#AccountTitle option:selected").text();
                                            //document.getElementById("cashID").value = tt;
                                            //srcText = tt;
                                            //mValFrom = $("#AccountTitle").val();

                                            //alert(tt + ForText);
                                        }
                                        else {
                                            // document.getElementById("cashID").value = document.getElementById("AccountTitle").value;
                                            //tt = $("#AccountTitle option:selected").text();
                                            //document.getElementById("paymentsID").value = tt;
                                            //ForText = tt;
                                            //mValTo = $("#AccountTitle").val();
                                            //alert(tt + srcText);
                                        }
                                        //alert(FormOption + " Submit");
                                    }

                                    // this handler is detached after it has run once
                                });
                            </script>
                        </div>

                    </div>
                    <!-- Model for Filter End **************************************-->
                    <!--*********************** Model for sub Data Entry **************************-->
                    <div id="SubCatEntry" class="modal fade">
                        <div class="modal-dialog">
                            <style>

                                .MyDelete
                                {
                                    background-image: url('MunshiImagesMain/Trash_Active.png');
                                    background-repeat: no-repeat;
                                    background-size: 24px 24px;
                                    color: #EB2227;
                                    padding: 4px;
                                    font-weight: bold;
                                }

                                    .MyDelete:hover
                                    {
                                        background-image: url('MunshiImagesMain/Trash_Deactive.png');
                                        background-repeat: no-repeat;
                                        background-size: 24px 24px;
                                        color: gray;
                                        padding: 4px;
                                        text-decoration: unset;
                                        font-weight: bold;
                                    }

                                .IconFill
                                {
                                    width: 40px;
                                    height: 40px;
                                    font-size: 30px;
                                    float: left;
                                    margin: 6px;
                                    color: #a1a1a1;
                                }

                                .ColorFill
                                {
                                    width: 30px;
                                    height: 30px;
                                    float: left;
                                    margin: 6px;
                                    border: solid 1px #a1a1a1;
                                }
                            </style>
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">

                                    <h4 class="modal-title"><span id="FilterTitle"></span></h4>
                                    <button type="button" class="close" data-dismiss="modal" onmouseup="OptFilter = 'Cancel';">&times;</button>

                                </div>
                                <div class="modal-body">

                                    <div id="InvDiv" class="row ">

                                        <div class=" col-lg-12 col-md-12 col-sm-12  ">

                                            <div class="col-lg-8 col-md-8 col-sm-8 ">
                                                Account Name
                                            </div>
                                            <div class="col-lg-2  col-md-2 col-sm-2 text-right">
                                                Color
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-2  text-right">
                                                <div style="text-align: center;width:50px; float:right;  ">Icon</div>


                                            </div>



                                            <div class="col-lg-8 col-md-8 col-sm-8 ">
                                                <input type="text" class="form-control" placeholder="Enter Name" id="CatName" style="border-radius:0px !important;">
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-2">
                                                <div id="divColor" onclick="$('#FillDivIcon').hide(); $('#FillDiv').toggle(); " style="cursor:pointer;float:right;width:38px; height:38px;background-color:red;border:solid 1px #a1a1a1;"></div>
                                            </div>
                                            <div class="col-lg-2 col-md-2 col-sm-2 ">
                                                <div onclick="$('#FillDiv').hide(); $('#FillDivIcon').toggle();" style="cursor:pointer;  text-align: center; background-color:whitesmoke; width:50px; height:38px;border:solid 1px #a1a1a1;float:right; padding:3px; padding-left:4px;">
                                                    <i id="IconS" style="font-size:30px;color:#a1a1a1; " class="fa fa-id-badge"></i>
                                                </div>
                                            </div>

                                            <div class="col-lg-12 col-md-12 col-sm-12 ">
                                                <div id="FillDiv" style="height:200px;  background-color: whitesmoke;border: 1px solid rgb(161, 161, 161);margin-left: 1px;margin-top: 25px; padding: 6px;overflow:auto;" class="col-12">

                                                </div>
                                                <div id="FillDivIcon" style="text-align:center; height:200px; background-color: whitesmoke;border: 1px solid rgb(161, 161, 161);margin-left: 1px;margin-top: 25px; padding: 6px;overflow:auto;" class="col-12">

                                                </div>
                                            </div>

                                            <div class="col-lg-12 col-md-12 col-sm-12">
                                                <div class="col-lg-12 col-md-12 col-sm-12 p-0 m-0">Opening Debit</div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 p-0 m-0">
                                                    <input type="text" class="form-control" placeholder="Opening Debit" id="OpenDR" style="border-radius:0px !important;">
                                                </div>
                                            </div>
                                            <div class="col-lg-12 col-md-12 col-sm-12">
                                                <div class="col-lg-12 col-md-12 col-sm-12 p-0 m-0">Opening Credit</div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 p-0 m-0">
                                                    <input type="text" class="form-control" placeholder="Opening Credit" id="OpenCR" style="border-radius:0px !important;">
                                                </div>
                                            </div>
                                            <style>
                                                .radio-inline input[type="radio"]
                                                {
                                                    margin-top: 4px;
                                                }
                                            </style>
                                            <div class="col-lg-12 col-md-12 col-sm-12">
                                                <div class="col-lg-12 col-md-12 col-sm-12 p-0 m-0">Select Account Nature</div>
                                                <div class="col-lg-12 col-md-12 col-sm-12 p-0 m-0">
                                                    <div class="form-control">
                                                        <label class="radio-inline"><input type="radio" name="optradio" value="Assets" checked>Assets</label>
                                                        <label class="radio-inline"><input type="radio" name="optradio" value="Liabilities">Liabilities</label>
                                                        <label class="radio-inline"><input type="radio" name="optradio" value="Equity">Equity</label>
                                                        <label class="radio-inline"><input type="radio" name="optradio" value="Expenses">Expenses</label>
                                                        <label class="radio-inline"><input type="radio" name="optradio" value="Income">Income</label>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="col-lg-12 col-md-12 col-sm-12">

                                                <div class="col-lg-12 col-md-12 col-sm-12 p-0 m-0 mt-1 ">
                                                    <input id="AccPayable" type="checkbox" />
                                                    <label for="AccPayable" style="font-size:14px;">Account May Be Used For Payment And Receipt ( e.g Cash / Bank )  </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class=" col-lg-12 col-md-12 col-sm-12">
                                            <div class="col-lg-12 col-md-12 col-sm-12 modal-footer">
                                                <div style="float:left;    margin-top: -2px;"><a id="btnDelet" href="#" class="MyDelete" data-dismiss="modal" onmouseup="OptFilter = 'Delete';">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;    Delete</a></div>
                                                <div style="float:right;">
                                                    <a id="btnReset" href="#" data-dismiss="modal" onmouseup="OptFilter = 'Cancel';" class="MyCancel">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;     Cancel</a>
                                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                                    <a id="btnsave" href="#" class="MySubmit" data-dismiss="modal" onmouseup="OptFilter = 'Apply';">&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;    Apply</a>
                                                </div>

                                            </div>


                                        </div>
                                    </div>



                                </div>

                            </div>
                            <script>
                                var edate = new Date();
                                var sdate = new Date(edate.getFullYear(), edate.getMonth() - 1, edate.getDate());
                                var Defa_A_Filter = "w";
                                var Defa_To_Filter = edate.getFullYear() + "/" + (edate.getMonth() + 1) + "/" + edate.getDate() + " 23:59:59";
                                var Defa_From_Filter = sdate.getFullYear() + "/" + (sdate.getMonth() + 1) + "/" + sdate.getDate() + " 00:00:00";





                                fillColor();
                                fillIcon();
                                function fillColor() {
                                    document.getElementById("FillDiv").style.display = "none";

                                    var colorArray = ['00FFFF', '7FFFD4', 'F0FFFF', 'F5F5DC', 'FFE4C4', '000000', 'FFEBCD', '0000FF', '8A2BE2', 'A52A2A', 'DEB887', '5F9EA0', '7FFF00',
                                        'D2691E', 'FF7F50', '6495ED', 'FFF8DC', 'DC143C', '00FFFF', '00008B', '008B8B', 'B8860B', 'A9A9A9', 'A9A9A9', '006400', 'BDB76B', '8B008B', '556B2F', 'FF8C00',
                                        '9932CC', '8B0000', 'E9967A', '8FBC8F', '483D8B', '2F4F4F', '2F4F4F', '00CED1', '9400D3', 'FF1493', 'FF1493'];
                                    var elem = document.getElementById("FillDiv");
                                    for (var a = 0; a < colorArray.length; a++) {
                                        var str = "";
                                        str = "<div onclick=ColorClicked('" + colorArray[a] + "') class='ColorFill' style='background-color:#" + colorArray[a] + ";' > </div>";
                                        elem.innerHTML = elem.innerHTML + str;
                                    }
                                }

                                function fillIcon() {
                                    document.getElementById("FillDivIcon").style.display = "none";

                                    var iconArray = ['android', 'apple', 'bluetooth', 'cc-mastercard', 'cc-paypal', 'cc-stripe', 'cc-visa', 'facebook', 'facebook-official', 'linkedin', 'linkedin-square', 'skype', 'twitter', 'twitter-square', 'whatsapp', 'windows', 'wordpress', 'yahoo', 'youtube', 'youtube-play', 'area-chart', 'bar-chart', 'line-chart', 'pie-chart', 'bitcoin', 'dollar', 'euro', 'gbp', 'money', 'usd', 'yen', 'arrow-down', 'arrow-left', 'arrow-right', 'arrow-up', 'file', 'file-pdf-o', 'photo-o', 'file-powerpoint-o', 'file-video-o', 'file-word-o', 'file-zip-o',
                                        'check-square-o', 'check-square', 'circle', 'circle-o', 'dot-circle-o', 'minus-square', 'minus-square-o', 'plus-square', 'plus-square-o', 'square', 'square-o', 'refresh', 'spinner', 'copy', 'cut', 'save', 'play', 'address-book', 'address-book-o', 'address-card-o', 'address-card', 'adjust', 'archive', 'barcode', 'book', 'briefcase', 'building-o', 'camera', 'comment', 'comment-o', 'comments', 'dashboard', 'database', 'desktop', 'diamond', 'download', 'edit', 'envelope', 'envelope-o', 'fax', 'folder', 'folder-o', 'folder-open', 'folder-open-o', 'history', 'home', 'hotel', 'hourglass-2', 'id-card', 'id-card-o', 'image', 'inbox', 'info', 'institution', 'keyboard-o', 'laptop', 'legal', 'line-chart', 'lock', 'male', 'map', 'map-o', 'map-signs', 'map-marker', 'minus', 'mobile-phone', 'mortar-board', 'mouse-pointer', 'phone', 'phone-square', 'photo', 'pie-chart', 'plus', 'plus-circle', 'print', 'rss', 'search-plus', 'shopping-cart', 'tablet', 'ticket', 'trash', 'trash-o', 'university', 'unlock', 'lock', 'upload', 'user', 'user-circle-o', 'video-camera'];
                                    var elem = document.getElementById("FillDivIcon");
                                    for (var a = 0; a < iconArray.length; a++) {
                                        var str = "";
                                        str = "<div onclick=IconClicked('" + iconArray[a] + "') class='IconFill' ><i class='fa fa-" + iconArray[a] + "'</i> </div>";
                                        elem.innerHTML = elem.innerHTML + str;
                                    }
                                }

                                function IconClicked(a) {
                                    document.getElementById("IconS").className = "fa fa-" + a;

                                }
                                function ColorClicked(a) {
                                    document.getElementById("divColor").style.backgroundColor = "#" + a;
                                }
                                var OptFilter = "";
                                var FormOptionOptFilter = "";
                                function SubShowPopup(a, b) {
                                    if (b == "Add") {
                                        document.getElementById("CatName").value = "";
                                        document.getElementById("divColor").style.backgroundColor = "black";
                                        document.getElementById("IconS").className = "fa fa-plus-circle";
                                        CatID = sessionStorage.getItem("CatID");

                                    }
                                    //alert(OptFilter);
                                    $("#FilterTitle").html(' <span style="color:oranged;">' + a + '</span> ');
                                    if (b == "Edit") {
                                        document.getElementById("btnDelet").style.display = "block";
                                    }
                                    else { document.getElementById("btnDelet").style.display = "none"; }
                                    $("#SubCatEntry").modal();
                                    FormOptionOptFilter = b;

                                }
                                $('#SubCatEntry').on('hidden.bs.modal', function (e) {
                                    //alert(OptFilter);
                                    if (OptFilter == "Cancel") {
                                        //alert("Reminder");
                                        //SendInvite("Reminder");
                                        //alert(FormOptionOptFilter + " Cancel");
                                    }
                                    else if (OptFilter == "Apply") {
                                        //alert("newInvitation");
                                        //SendInvite("newInvitation");
                                        var tt;
                                        if (FormOptionOptFilter == "Edit") {
                                            NatureSubCatID("update");
                                            //updateAccount();

                                        }
                                        else {
                                            NatureSubCatID("insert");

                                        }
                                        //alert(FormOption + " Submit");
                                    } else if (OptFilter == "Delete") {
                                        Delete();
                                    }

                                    // this handler is detached after it has run once
                                });


                                function NatureSubCatID(a) {
                                    var userid = window.sessionStorage.getItem("UserID");
                                    var nature = document.querySelector('input[name="optradio"]:checked').value;
                                    sessionStorage.setItem("CatNature", nature);

                            
                                        $.ajax({
                                            type: 'POST',
                                            url: "Accounts.asmx/NatureSubCatID",
                                            dataType: 'json',
                                            data: "{'UserID':'" + userid + "','Nature':'" + nature + "'}",
                                            contentType: 'application/json; charset=utf-8',

                                            success: function (response) {

                                              
 


                                                var txt = '{"Row": ' + response.d + '}';
                                                var data = JSON.parse(txt);

                                                if (data.Row.length > 0) {

                                                    //Subcatid = data.Row[0].CatId;
                                                    CatID = data.Row[0].CatId;
                                                   // Subcatid = data.Row[0].CatId;
                                                    sessionStorage.setItem("SubCatID", data.Row[0].CatId);
                                                    sessionStorage.setItem("CatID", data.Row[0].MainID);
                                                    
                                                    if (a == "insert") {
                                                        insertCategory(CatID);
                                                    }
                                                    else {
                                                        updateAccount(CatID);
                                                    }

                                                }
                                                else
                                                   // alert("some issue to insert data");

                                                $.alert({ title: 'Alert!', content: 'some issue to insert data' });

                                            },
                                            error: function (error) {
                                                console.log(error);
                                            }
                                        });
                                


                                }


                                function insertCategory(a) {
                                    // var mCat, mCol, mIcon;
                                    var accID = AccountID1;
                                    if (mCat == "") {
                                        return "";
                                    }
                                    var nature = document.querySelector('input[name="optradio"]:checked').value;
                                    var mCat = document.getElementById("CatName").value;
                                    var mCol = document.getElementById("divColor").style.backgroundColor;
                                    var mIcon = document.getElementById("IconS").className;
                                    var type = "E";
                                    var userid = window.sessionStorage.getItem("UserID");
                                    var subcatid = a;

                                    var opDR = 0;
                                    opDR = document.getElementById("OpenDR").value;
                                    var opCR = 0;
                                    opCR = document.getElementById("OpenCR").value;


                                    var email = '--'; //document.getElementById("txtEmail").value;
                                    var mobile = '--'; // document.getElementById("txtMobile").value;
                                    //var payacc= $('input[id=chkpayrec]').is(':checked')
                                    //var payacc = document.getElementById("chkpayrec").checked;

                                    var payacc = 0;
                                    var incacc = 0;
                                    var expacc = 0;
                                    if ($('#AccPayable').is(":checked")) {

                                        payacc = 1;
                                    }




                                    incacc = 0;


                                    expacc = 0;


                               
                                        var nature1 = sessionStorage.getItem("CatNature");

                                        $.ajax({
                                            type: 'POST',
                                            url: 'Accounts.asmx/addAccount',
                                            dataType: 'json',
                                            contentType: 'application/json; charset=utf-8',
                                            data: "{'Title':'" + mCat + "','opDR':'" + opDR + "','opCR':'" + opCR + "','Email':'" + email + "','Mobile':'" + mobile + "','mColor':'" + mCol + "','mIcon':'" + mIcon + "','SubCatId':'" + subcatid + "','payrec':'" + payacc + "','incacc': '" + incacc + "', 'expacc': '" + expacc + "','Nature':'" + nature1 + "'}",
                                            success: function (response) {

                                              
                                                // alert(response.d);
                                                //alert("Account Added Successfully");
                                                $.alert({ title: 'Alert!', content: 'Account Added Successfully' });
                                                getLedger("ALL");
                                                //LoadFile("DashboardAccounts.html");

                                                //  alert(response.d);

                                            },
                                            error: function (error) {
                                                //alert(response.d);
                                                console.log(error);
                                            }
                                        });

                              



                                }

                                function updateAccount(a) {
                                    // var mCat, mCol, mIcon;

                                    var nature = document.querySelector('input[name="optradio"]:checked').value;
                                    var accID = AccountID1;
                                    var mCat = document.getElementById("CatName").value;
                                    var mCol = document.getElementById("divColor").style.backgroundColor;
                                    var mIcon = document.getElementById("IconS").className;
                                    var type = "E";
                                    var userid = window.sessionStorage.getItem("UserID");
                                    var subcatid = a;

                                    var opDR = 0;
                                    opDR = document.getElementById("OpenDR").value;
                                    var opCR = 0;
                                    opCR = document.getElementById("OpenCR").value;
                                    // var email = document.getElementById("txtEmail").value;
                                    // var mobile = document.getElementById("txtMobile").value;
                                    //var payacc= $('input[id=chkpayrec]').is(':checked')
                                    //var payacc = document.getElementById("chkpayrec").checked;

                                    var payacc = 0;
                                    var incacc = 0;
                                    var expacc = 0;
                                    if ($('#AccPayable').is(":checked")) {

                                        payacc = 1;
                                    }




                                    incacc = 0;


                                    expacc = 0;

                                    //alert("{'AccountID':'" + accID + "','AccountTitle':'" + mCat + "', 'OpeningDebit':'" + opDR + "', 'OpeningCredit':'" + opCR + "','ActiveStatus':'1',  'CellNo':'--', 'Email':'--', 'SubCatID':'" + subcatid + "', 'color':'" + mCol + "', 'Icon':'" + mIcon + "', 'PaySource':'" + payacc + "', 'Inc':'" + incacc + "', 'Exp':'" + expacc + "'}");

                                  
                                       

                                        $.ajax({
                                            type: 'POST',
                                            url: 'Accounts.asmx/updateAccount',
                                            dataType: 'json',
                                            contentType: 'application/json; charset=utf-8',

                                            data: "{'AccountID':'" + accID + "','AccountTitle':'" + mCat + "', 'OpeningDebit':'" + opDR + "', 'OpeningCredit':'" + opCR + "','ActiveStatus':'1',  'CellNo':'--', 'Email':'--', 'SubCatID':'" + subcatid + "', 'color':'" + mCol + "', 'Icon':'" + mIcon + "', 'PaySource':'" + payacc + "', 'Inc':'" + incacc + "', 'Exp':'" + expacc + "','Nature':'" + nature + "'}",
                                            success: function (response) {
 


                                                if (response.d == "1") {
                                                    //alert("Account Updated");
                                                    $.alert({ title: 'Alert!', content: 'Account Updated' });
                                                    //document.location.href = "ShowAccounts.html";
                                                    getLedger("ALL");
                                                }
                                                else {
                                                    //alert("Technical issue. Please try again");
                                                    $.alert({ title: 'Alert!', content: 'Technical issue. Please try again' });
                                                }

                                                //  alert(response.d);

                                            },
                                            error: function (error) {
                                                console.log(error);
                                            }
                                        });

                                 

                                }

                                function Delete() {
                                    // var mCat, mCol, mIcon;
                                    var accID = AccountID1;

 
                                        $.ajax({
                                            type: 'POST',
                                            url: 'Accounts.asmx/DeleteAccount',
                                            dataType: 'json',
                                            contentType: 'application/json; charset=utf-8',

                                            data: "{'AccountID':'" + accID + "'}",
                                            success: function (response) {

 

                                                if (response.d == "1") {
                                                    //alert("Account Updated");
                                                    $.alert({ title: 'Alert!', content: 'Account Deleted' });
                                                    getLedger("ALL");
                                                }
                                                else {
                                                    $.alert({ title: 'Alert!', content: 'Account not deleted; please delete all transactions first' });
                                                   // alert("Account not deleted; please delete all transactions first");
                                                }

                                                //  alert(response.d);

                                            },
                                            error: function (error) {
                                                console.log(error);
                                            }
                                        });


                                
                                }
                            </script>
                        </div>

                    </div>
                    <!--*********************** Model for sub Data Entry End **********************-->
                    <!--*********************** Model for sub Data Entry **************************-->
                    <div id="EntryGraph" class="modal fade">
                        <div class="modal-dialog">

                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">

                                    <h4 class="modal-title"><span id="BudgetFilterTitle"></span></h4>
                                    <button type="button" class="close" data-dismiss="modal" onmouseup="OptFilter = 'Cancel';">&times;</button>

                                </div>
                                <div class="modal-body">

                                    <div id="InvDiv" class="row ">

                                        <div class="col-sm-12 col-md-12 col-lg-12">
                                            <div class="box dashboard-box" style="border:0;">
                                                <div class="col-md-12 col-lg-12 graph no-padding">
                                                    <div class="dashboard-box-g">
                                                        <div style="width:100%; height:100%;">
                                                            <canvas id="CChartPopup"></canvas>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>



                                </div>

                            </div>
                            <script>
                                var DataBudget = [];
                                var DataTrans = [];
                                var Lable = [];
                                var myChartPopup = [];
                                var chartOptionpopup;
                                var scalevaluepopup;
                                var chartdatapopup;
                                function EntryGraph(a) {
                                    var dat = a.split(":");
                                    $("#BudgetFilterTitle").html("Budget Status of " + dat[1])
                                    $("#EntryGraph").modal();
                                    $('#loader').show();


                               

                                        $.ajax({
                                            type: 'POST',
                                            url: 'Accounts.asmx/BudgetAnalysisMonth',
                                            dataType: 'json',
                                            data: "{'AccountID':'" + dat[0] + "'}",
                                            contentType: 'application/json; charset=utf-8',

                                            success: function (response) {


 



                                                DataBudget = [];
                                                DataTrans = [];
                                                Lable = [];
                                                myChartPopup = [];
                                                var txt = '{"Row": ' + response.d + '}';
                                                var data = JSON.parse(txt);
                                                LedgerObj = [];
                                                for (var i = 0; i < data.Row.length; i++) {
                                                    //AccountID,Accounttitle,budgetamount,intrans,inledger,innetworth,infullstatement,inbalancesheet,budgettype
                                                    DataTrans.push(Math.abs(data.Row[i].Balance));
                                                    DataBudget.push(data.Row[i].BudgetAmount);
                                                    Lable.push(data.Row[i].Main);

                                                }
                                                drawchartPopup();
                                                $('#spandataloading').hide();
                                                $('#loader').hide();
                                                //$('#loadI').attr('class', 'fa fa-gear');


                                            },
                                            error: function (error) {
                                                console.log(error);
                                            }
                                        });



                                  





                                }
                                function drawchartPopup() {
                                    scalevaluepopup = {
                                        yAxes: [{
                                            ticks: {
                                                beginAtZero: true,
                                                fontSize: 8,
                                                display: true
                                            },
                                            gridLines: {
                                                display: true,
                                                drawBorder: true
                                            }

                                        }],

                                        xAxes: [{
                                            barPercentage: 1,
                                            offset: true,
                                            ticks: {
                                                minRotation: 0,
                                                display: true //this will remove only the label
                                            },
                                            gridLines: {
                                                display: false
                                                ,
                                                drawBorder: true
                                            }
                                        }]
                                    }

                                    
                                    chartOptionpopup = {


                                        maintainAspectRatio: false,
                                        cutoutPercentage: 30,
                                        scales: scalevaluepopup,
                                        legend: {
                                            display: false
                                        }
                                    }


                                    chartdatapopup = {
                                        labels: Lable,

                                        datasets: [{
                                            label: 'Budget ',
                                            data: DataBudget,

                                            backgroundColor: '#06a953',
                                            borderColor: '#06a953',
                                            borderWidth: 1
                                        },
                                        {
                                            label: 'Transaction ',
                                            data: DataTrans,

                                            backgroundColor: '#e20707',
                                            borderColor: '#e20707',
                                            borderWidth: 1
                                        }


                                        ]
                                    };

                                    var ctx = document.getElementById("CChartPopup");
                                    if (myChartPopup.length > 0) {
                                        var MChart = myChartPopup[1];
                                        MChart.destroy();
                                    }
                                    myChartPopup[1] = new Chart(ctx, {
                                        type: 'bar',
                                        data: chartdatapopup,
                                        options: chartOptionpopup
                                    });

                                }
                            </script>
                        </div>

                    </div>
                    <!--*********************** Model for sub Data Entry End **********************-->



                </div>
