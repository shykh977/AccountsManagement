<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Add Category</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="Munshi Retail System" name="SISTECH SYSTEM" />
    <meta content="Coderthemes" name="author" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">

    <!-- App css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" id="bootstrap-stylesheet" />
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/app.min.css" rel="stylesheet" type="text/css" id="app-stylesheet" />
    <script type="text/javascript">
        function f1() {
            var str = document.getElementById("catname").value;
            alert("your catname is :" + str);
        }
    </script>
</head>
<body>
    <!-- start page title -->
    <div class="row">
        <div class="col-12">
            <div class="page-title-box">
                <div class="page-title-right">
                    <ol class="breadcrumb m-0">
                        <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboard </a></li>
                        <li class="breadcrumb-item"><a href="javascript: void(0);">Add Category</a></li>
                    </ol>
                </div>
                <h4 class="page-title">Add Category</h4>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card-box">
                <h1 class="mt-5 mb-5" align="center">Add Category</h1>
                <div class="row">
                    <div class="col-4"></div>
                    <div class="col-4">
                        <form>
                            <div class="form-group">
                                <label for="email">CATEGORY NAME:</label>
                                <input class="form-control" id="catname" placeholder="Enter Category Here">
                            </div>
                            <div class="form-group">
                                <button type="button" onclick="Save();" class="btn btn-success" id="btn1">SAVE</button>
                            </div>
                        </form>

                    </div>
                    <div class="col-4"></div>
                </div>
                <div class="row">
                    <div class="col-12">
                        <div class="table-responsive">
                            <table class="table table-striped mb-0">
                                <thead class="thead-dark">
                                    <tr>
                                        <th>S/No</th>
                                        <th>CATEGORY NAME</th>
                                        <th>EDIT</th>
                                        <th>DELETE</th>
                                    </tr>
                                </thead>
                                <tbody id="Categories">
                                    <tr></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div> <!-- Card-Box end-->
        </div> <!--main-col end-->
    </div><!--main-Row end-->
    <!-- END wrapper -->

    <!-- JavaScript Files -->
    <script>
        var POSID = sessionStorage.getItem("POSID");
        
        Load();
        function Insert() {
            var catname = document.getElementById("catname").value;            
            if (catname == '') {
                alert("Improper inputs provided..please enter proper Data");
            }
            else {
                $.ajax({
                    type: 'POST',
                    url: "CategoriesAdd.asmx/InsertCategories",
                    dataType: 'json',                    
                    data: "{'catname':'" + catname + "','buisnessid':'" + POSID +"'}",
                    contentType: 'application/json; charset=utf-8',
                    success: function (response) {                 
                        alert("Data has been saved.");
                        Load();
                    },
                    error: function (error) {
                        alert(error);
                    }
                });
            }
        }

        function Load() {
            TType = "New";
            clear();
            $.ajax({
                type: 'POST',
                url: 'CategoriesAdd.asmx/LoadCategories',
                dataType: 'json',
                data: "{'POSID':'"+POSID+"'}",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    var txt = '{"Row": ' + response.d + '}';
                    var data = JSON.parse(txt);
                    var str = "";
                    var dt = "";
                    var mRow = 0;
                    for (var i = 0; i < data.Row.length; i++) {
                        mRow++;
                        dt = dt + "<tr>";
                        dt = dt + "<td>" + mRow + "</td>";
                        dt = dt + "<td>" + data.Row[i].catname + "</td>";
                        dt = dt + " <td><a href='#' onclick=Edit('" + data.Row[i].catid + "');><i class='fa fa-edit'></i> EDIT</a></td>";
                        dt = dt + " <td><a href='#'  onclick=Delete('" + data.Row[i].catid + "');><i class='fa fa-trash' style='color:red'></i> DELETE</a></td>";
                        dt = dt + " </tr>";
                        str = str + dt;
                        dt = "";
                    }
                    document.getElementById('Categories').innerHTML = str;
                },
                error: function (error) {
                    alert(error);
                }
            });
        }

        function Edit(catid) {  
            TType = "Edit";
            $.ajax({
                type: 'POST',
                url: 'CategoriesAdd.asmx/EditCategories',
                dataType: 'json',
                data: "{'catid':'" + catid + "'}",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {                    
                    var txt = '{"Row": ' + response.d + '}';
                    var data = JSON.parse(txt);
                    window.sessionStorage.setItem("catid", data.Row[0].catid);
                    document.getElementById("catname").value = data.Row[0].catname;
                },
                error: function (error) {
                    alert(error);
                }
            });
        }

        function update() {
            var catid = sessionStorage.getItem("catid");
            var catname = document.getElementById("catname").value;            
            $.ajax({
                type: 'POST',
                url: 'CategoriesAdd.asmx/UpdateCategories',
                dataType: 'json',
                data: "{'catid':'" + catid + "','catname':'" + catname + "'}",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    var txt = '{"Row": ' + response.d + '}';
                    var data = JSON.parse(txt);
                    alert("Data has been Updated.");
                    TType = "New";                    
                    Load();
                },
                error: function (error) {
                    alert(error);
                }
            });
        }

        function Delete(catid) {
            $.ajax({
                type: 'POST',
                url: 'CategoriesAdd.asmx/DeleteCategories',
                dataType: 'json',
                data: "{'catid':'" + catid + "'}",
                contentType: 'application/json; charset=utf-8',
                success: function (response) {
                    var txt = '{"Row": ' + response.d + '}';
                    var data = JSON.parse(txt);
                    alert("Data has been Deleted.");
                    Load();
                },
                error: function (error) {
                    alert(error);
                }
            });
        }

        function Save() {
            if (TType == "New") { Insert(); }
            else { update(); }
        }
        function clear() {
            $(':input').val('');
        }
    </script>
</body>
</html>